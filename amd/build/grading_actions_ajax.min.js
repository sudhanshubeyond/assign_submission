define(["jquery","core/ajax","core/templates","core/notification","core/str",],function(e,r,i,a,t){return{init:function(){var r,i,t=window.location.href,n=s("id",t),o=s("userid",t),l=100;setInterval(function(){e("#id_fill_ai_grade").prop("disabled")&&e.ajax({url:M.cfg.wwwroot+"/local/assign_submission/ajax.php",method:"POST",data:{action:"getgrades",cmid:n,userid:o,sesskey:M.cfg.sesskey},success:function(r){try{200==r.status&&(" "!=r.grade||null!=r.errormessage)&&e("#id_fill_ai_grade").prop("disabled",!1).attr("title","").html("AI Grading")}catch(i){console.log("There is some issue please try again later")}},error:function(e){console.log("AJAX error: "+e.statusText)}})},5e3),e(document).on("click","#id_fill_ai_grade",(r=function(r){e.ajax({url:M.cfg.wwwroot+"/local/assign_submission/ajax.php",method:"POST",data:{action:"getgrades",cmid:n,userid:o,sesskey:M.cfg.sesskey},success:function(r){try{if(200==r.status){if(null!==r.errormessage){let i=`There is some issue with following message "<strong>${r.errormessage}</strong>" kindly grade this manually`;a.alert("Grading Issue",i,"OK")}else{let t=JSON.parse(r.rubricbreakdown);t.forEach(e=>{let r=`advancedgrading-criteria-${e.criterionid}-levels-${e.selectedlevelid}`,i=`advancedgrading-criteria-${e.criterionid}-remark`,a=document.getElementById(r),t=document.getElementById(i);t?(t.value=e.feedback,t.style.display="block"):console.warn(`Textarea not found for criterion ${e.criterionid}`),a?a.click():console.warn(`Element with ID '${r}' not found.`)});let s=document.getElementById("id_assignfeedbackcomments_editoreditable");s&&(s.focus(),s.click(),s.innerHTML=r.feedback,s.dispatchEvent(new Event("input",{bubbles:!0}))),e("#id_grade").val(r.grade)}}}catch(n){alert("There is some issue please try again later")}},error:function(e){alert("AJAX error: "+e.statusText)}})},i=0,function(){var e=this,a=arguments;clearTimeout(i),i=setTimeout(function(){r.apply(e,a)},100)}))}};function s(e,r){return decodeURIComponent((RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(r)||[null,""])[1].replace(/\+/g,"%20"))||null}});