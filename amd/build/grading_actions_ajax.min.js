define(["jquery","core/ajax","core/templates","core/notification",],function(e,i,t,r){return{init:function(){var i,t,n=window.location.href,s=a("id",n),c=a("userid",n),o=100;e(document).on("click","#id_fill_ai_grade",(i=function(i){e(this).attr("data-programid"),e(this).attr("data-id"),e(this).attr("cmid"),e.ajax({url:M.cfg.wwwroot+"/local/assign_submission/ajax.php",method:"POST",data:{action:"getgrades",cmid:s,userid:c,sesskey:M.cfg.sesskey},success:function(i){try{if(200==i.status){if(null!==i.errormessage){let t=`There is some issue with following message "<strong>${i.errormessage}</strong>" kindly grade this manually`;r.alert("Grading Issue",t,"OK")}else{let a=JSON.parse(i.rubricbreakdown);a.forEach(e=>{let i=`advancedgrading-criteria-${e.criterionid}-levels-${e.selectedlevelid}`,t=`advancedgrading-criteria-${e.criterionid}-remark`,r=document.getElementById(i),a=document.getElementById(t);a?(a.value=e.feedback,a.style.display="block"):console.warn(`Textarea not found for criterion ${e.criterionid}`),r?r.click():console.warn(`Element with ID '${i}' not found.`)});let n=document.getElementById("id_assignfeedbackcomments_editoreditable");n&&(n.focus(),n.click(),n.innerHTML=i.feedback,n.dispatchEvent(new Event("input",{bubbles:!0}))),e("#id_grade").val(i.grade)}}}catch(s){alert("There is some issue please try again later")}},error:function(e){alert("AJAX error: "+e.statusText)}})},t=0,function(){var e=this,r=arguments;clearTimeout(t),t=setTimeout(function(){i.apply(e,r)},100)}))}};function a(e,i){return decodeURIComponent((RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(i)||[null,""])[1].replace(/\+/g,"%20"))||null}});