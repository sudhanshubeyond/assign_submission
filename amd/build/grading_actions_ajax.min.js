define(["jquery","core/ajax","core/templates","core/notification","core/str",],function(e,i,r,a,t){return{init:function(){var i,r,t=window.location.href,n=s("id",t),o=s("userid",t),l=100;setInterval(function(){e("#id_fill_ai_grade").prop("disabled")&&e.ajax({url:M.cfg.wwwroot+"/local/assign_submission/ajax.php",method:"POST",data:{action:"getgrades",cmid:n,userid:o,sesskey:M.cfg.sesskey},success:function(i){try{200==i.status&&e("#id_fill_ai_grade").prop("disabled",!1).attr("title","").html("AI Grading")}catch(r){console.log("There is some issue please try again later")}},error:function(e){console.log("AJAX error: "+e.statusText)}})},5e3),e(document).on("click","#id_fill_ai_grade",(i=function(i){e.ajax({url:M.cfg.wwwroot+"/local/assign_submission/ajax.php",method:"POST",data:{action:"getgrades",cmid:n,userid:o,sesskey:M.cfg.sesskey},success:function(i){try{if(200==i.status){if(null!==i.errormessage){let r=`There is some issue with following message "<strong>${i.errormessage}</strong>" kindly grade this manually`;a.alert("Grading Issue",r,"OK")}else{let t=JSON.parse(i.rubricbreakdown);t.forEach(e=>{let i=`advancedgrading-criteria-${e.criterionid}-levels-${e.selectedlevelid}`,r=`advancedgrading-criteria-${e.criterionid}-remark`,a=document.getElementById(i),t=document.getElementById(r);t?(t.value=e.feedback,t.style.display="block"):console.warn(`Textarea not found for criterion ${e.criterionid}`),a?a.click():console.warn(`Element with ID '${i}' not found.`)});let s=document.getElementById("id_assignfeedbackcomments_editoreditable");s&&(s.focus(),s.click(),s.innerHTML=i.feedback,s.dispatchEvent(new Event("input",{bubbles:!0}))),e("#id_grade").val(i.grade)}}}catch(n){alert("There is some issue please try again later")}},error:function(e){alert("AJAX error: "+e.statusText)}})},r=0,function(){var e=this,a=arguments;clearTimeout(r),r=setTimeout(function(){i.apply(e,a)},100)}))}};function s(e,i){return decodeURIComponent((RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(i)||[null,""])[1].replace(/\+/g,"%20"))||null}});